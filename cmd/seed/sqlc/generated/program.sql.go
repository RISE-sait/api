// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: program.sql

package db_seed

import (
	"context"

	"github.com/lib/pq"
)

const insertBuiltInPrograms = `-- name: InsertBuiltInPrograms :exec



INSERT INTO program.programs (id, name, type, description)
VALUES
    (gen_random_uuid(), 'Game', 'game', 'Default program for games'),
    (gen_random_uuid(), 'Practice', 'practice', 'Default program for practices'),
    (gen_random_uuid(), 'Course', 'course', 'Default program for courses'),
    (gen_random_uuid(), 'Other', 'other', 'Default program for other events')
ON CONFLICT (type) DO NOTHING
`

// -- name: InsertPractices :many
// WITH prepared_data as (SELECT unnest(@name_array::text[])                   as name,
//
//	unnest(@description_array::text[])            as description,
//	unnest(@level_array::program.program_level[]) as level,
//	unnest(@is_pay_per_event_array::boolean[])    AS pay_per_event)
//
// INSERT
// INTO program.programs (name, description, type, level, pay_per_event)
// SELECT name,
//
//	description,
//	'practice',
//	level,
//	pay_per_event
//
// FROM prepared_data
// RETURNING id;
// -- name: InsertCourses :exec
// WITH prepared_data as (SELECT unnest(@name_array::text[])                   as name,
//
//	unnest(@description_array::text[])            as description,
//	unnest(@level_array::program.program_level[]) as level,
//	unnest(@is_pay_per_event_array::boolean[])    AS pay_per_event)
//
// INSERT
// INTO program.programs (name, description, type, level, pay_per_event)
// SELECT name,
//
//	description,
//	'course',
//	level,
//	pay_per_event
//
// FROM prepared_data;
// -- name: InsertGames :exec
// WITH prepared_data as (SELECT unnest(@name_array::text[])                   as name,
//
//	                         unnest(@description_array::text[])            as description,
//	                         unnest(@level_array::program.program_level[]) as level,
//	                         unnest(@is_pay_per_event_array::boolean[])    AS pay_per_event),
//	game_ids AS (
//	    INSERT INTO program.programs (name, description, type, level, pay_per_event)
//	        SELECT name, description, 'game', level, pay_per_event
//	        FROM prepared_data
//	        RETURNING id)
//
// INSERT
// INTO program.games (id, win_team, lose_team, win_score, lose_score)
// VALUES (unnest(ARRAY(SELECT id FROM game_ids)), unnest(@win_team_array::uuid[]), unnest(@lose_team_array::uuid[]),
//
//	unnest(@win_score_array::int[]), unnest(@lose_score_array::int[]));
//
// -- name: InsertProgramFees :exec
// WITH prepared_data AS (SELECT unnest(@program_name_array::varchar[])            AS program_name,
//
//	unnest(@membership_name_array::varchar[])         AS membership_name,
//	unnest(@stripe_program_price_id_array::varchar[]) AS stripe_program_price_id)
//
// INSERT
// INTO program.fees (program_id, membership_id, stripe_price_id)
// SELECT p.id,
//
//	CASE
//	    WHEN m.id IS NULL THEN NULL::uuid
//	    ELSE m.id
//	    END,
//	stripe_program_price_id
//
// FROM prepared_data
//
//	JOIN program.programs p ON p.name = program_name
//	LEFT JOIN membership.memberships m ON m.name = membership_name
//
// WHERE stripe_program_price_id <> ‚Äù;
func (q *Queries) InsertBuiltInPrograms(ctx context.Context) error {
	_, err := q.db.ExecContext(ctx, insertBuiltInPrograms)
	return err
}

const insertProgramFees = `-- name: InsertProgramFees :exec
WITH prepared_data AS (
    SELECT
        unnest($1::varchar[])            AS program_name,
        unnest($2::varchar[])         AS membership_name,
        unnest($3::varchar[]) AS stripe_program_price_id
)
INSERT INTO program.fees (program_id, membership_id, stripe_price_id)
SELECT
    p.id,
    CASE WHEN m.id IS NULL THEN NULL::uuid ELSE m.id END,
    stripe_program_price_id
FROM prepared_data
JOIN program.programs p ON p.name = program_name
LEFT JOIN membership.memberships m ON m.name = membership_name
WHERE stripe_program_price_id <> ''
`

type InsertProgramFeesParams struct {
	ProgramNameArray          []string `json:"program_name_array"`
	MembershipNameArray       []string `json:"membership_name_array"`
	StripeProgramPriceIDArray []string `json:"stripe_program_price_id_array"`
}

func (q *Queries) InsertProgramFees(ctx context.Context, arg InsertProgramFeesParams) error {
	_, err := q.db.ExecContext(ctx, insertProgramFees, pq.Array(arg.ProgramNameArray), pq.Array(arg.MembershipNameArray), pq.Array(arg.StripeProgramPriceIDArray))
	return err
}
