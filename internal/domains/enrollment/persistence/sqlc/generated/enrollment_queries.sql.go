// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.27.0
// source: enrollment_queries.sql

package db

import (
	"context"
	"database/sql"

	"github.com/google/uuid"
)

const enrollCustomer = `-- name: EnrollCustomer :one
INSERT INTO customer_enrollment (customer_id, event_id, checked_in_at, is_cancelled)
VALUES ($1, $2, $3, $4)
RETURNING id, customer_id, event_id, created_at, updated_at, checked_in_at, is_cancelled
`

type EnrollCustomerParams struct {
	CustomerID  uuid.UUID    `json:"customer_id"`
	EventID     uuid.UUID    `json:"event_id"`
	CheckedInAt sql.NullTime `json:"checked_in_at"`
	IsCancelled bool         `json:"is_cancelled"`
}

func (q *Queries) EnrollCustomer(ctx context.Context, arg EnrollCustomerParams) (CustomerEnrollment, error) {
	row := q.db.QueryRowContext(ctx, enrollCustomer,
		arg.CustomerID,
		arg.EventID,
		arg.CheckedInAt,
		arg.IsCancelled,
	)
	var i CustomerEnrollment
	err := row.Scan(
		&i.ID,
		&i.CustomerID,
		&i.EventID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.CheckedInAt,
		&i.IsCancelled,
	)
	return i, err
}

const getCustomerEnrollments = `-- name: GetCustomerEnrollments :many
SELECT customer_enrollment.id, customer_enrollment.customer_id, customer_enrollment.event_id, customer_enrollment.created_at, customer_enrollment.updated_at, customer_enrollment.checked_in_at, customer_enrollment.is_cancelled, users.email FROM customer_enrollment
         JOIN users ON customer_enrollment.customer_id = users.id
         WHERE (customer_id = COALESCE($1, customer_id)
         OR
                event_id = COALESCE($2, event_id)
                   )
`

type GetCustomerEnrollmentsParams struct {
	CustomerID uuid.NullUUID `json:"customer_id"`
	EventID    uuid.NullUUID `json:"event_id"`
}

type GetCustomerEnrollmentsRow struct {
	ID          uuid.UUID    `json:"id"`
	CustomerID  uuid.UUID    `json:"customer_id"`
	EventID     uuid.UUID    `json:"event_id"`
	CreatedAt   sql.NullTime `json:"created_at"`
	UpdatedAt   sql.NullTime `json:"updated_at"`
	CheckedInAt sql.NullTime `json:"checked_in_at"`
	IsCancelled bool         `json:"is_cancelled"`
	Email       string       `json:"email"`
}

func (q *Queries) GetCustomerEnrollments(ctx context.Context, arg GetCustomerEnrollmentsParams) ([]GetCustomerEnrollmentsRow, error) {
	rows, err := q.db.QueryContext(ctx, getCustomerEnrollments, arg.CustomerID, arg.EventID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetCustomerEnrollmentsRow
	for rows.Next() {
		var i GetCustomerEnrollmentsRow
		if err := rows.Scan(
			&i.ID,
			&i.CustomerID,
			&i.EventID,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.CheckedInAt,
			&i.IsCancelled,
			&i.Email,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const unEnrollCustomer = `-- name: UnEnrollCustomer :execrows
DELETE FROM customer_enrollment WHERE id = $1
`

func (q *Queries) UnEnrollCustomer(ctx context.Context, id uuid.UUID) (int64, error) {
	result, err := q.db.ExecContext(ctx, unEnrollCustomer, id)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}
